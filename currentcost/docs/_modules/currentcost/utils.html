

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>currentcost.utils &mdash; phase-currentcost 1.0.0 documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  
    <link rel="top" title="phase-currentcost 1.0.0 documentation" href="../../index.html"/>
        <link rel="up" title="Module code" href="../index.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        <a href="../../index.html" class="fa fa-home"> phase-currentcost</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
        
            <ul>
<li class="toctree-l1"><a class="reference internal" href="../../presentation.html">phase-currentcost</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../presentation.html#installation">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../presentation.html#usage">Usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../presentation.html#examples">Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../presentation.html#message-send-through-rabbitmq">Message send through RabbitMQ</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../presentation.html#issue">Issue</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../presentation.html#contribute">Contribute</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../presentation.html#license">License</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../code.html">Modules</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../code.html#workflow">Workflow</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../code.html#test-plan">Test plan</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../code.html#utils-module">Utils module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../code.html#module-currentcost.messager">RabbitMQ_messager module</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../todo.html">Todo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../change.html">Changelog</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../change.html#phase-currentcost-v1-0-0-stable-urgency-low">phase-currentcost (v1.0.0) stable; urgency=low</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../change.html#phase-currentcost-v0-9-17-stable-urgency-low">phase-currentcost (v0.9.17) stable; urgency=low</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../change.html#phase-currentcost-v0-9-16-stable-urgency-low">phase-currentcost (v0.9.16) stable; urgency=low</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../change.html#phase-currentcost-v0-9-15-stable-urgency-low">phase-currentcost (v0.9.15) stable; urgency=low</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../change.html#phase-currentcost-v0-9-14-stable-urgency-low">phase-currentcost (v0.9.14) stable; urgency=low</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../change.html#phase-currentcost-v0-9-13-stable-urgency-low">phase-currentcost (v0.9.13) stable; urgency=low</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../change.html#phase-currentcost-v0-9-12-stable-urgency-low">phase-currentcost (v0.9.12) stable; urgency=low</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../change.html#phase-currentcost-v0-9-11-stable-urgency-low">phase-currentcost (v0.9.11) stable; urgency=low</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../change.html#phase-currentcost-v0-9-10-stable-urgency-low">phase-currentcost (v0.9.10) stable; urgency=low</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../change.html#phase-currentcost-v0-9-9-stable-urgency-low">phase-currentcost (v0.9.9) stable; urgency=low</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../change.html#phase-currentcost-v0-9-8-stable-urgency-low">phase-currentcost (v0.9.8) stable; urgency=low</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../change.html#phase-currentcost-v0-9-7-stable-urgency-low">phase-currentcost (v0.9.7) stable; urgency=low</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../change.html#phase-currentcost-v0-9-6-stable-urgency-low">phase-currentcost (v0.9.6) stable; urgency=low</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../change.html#phase-currentcost-v0-9-5-stable-urgency-low">phase-currentcost (v0.9.5) stable; urgency=low</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../change.html#phase-currentcost-v0-9-4-stable-urgency-low">phase-currentcost (v0.9.4) stable; urgency=low</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../change.html#phase-currentcost-v0-9-3-stable-urgency-low">phase-currentcost (v0.9.3) stable; urgency=low</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../change.html#phase-currentcost-v0-9-2-stable-urgency-low">phase-currentcost (v0.9.2) stable; urgency=low</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../change.html#phase-currentcost-v0-9-1-stable-urgency-low">phase-currentcost (v0.9.1) stable; urgency=low</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../change.html#phase-currentcost-v0-9-0-stable-urgency-low">phase-currentcost (v0.9.0) stable; urgency=low</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../change.html#phase-currentcost-v0-8-0-unstable-urgency-low">phase-currentcost (v0.8.0) unstable; urgency=low</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../change.html#phase-currentcost-v0-7-0-unstable-urgency-low">phase-currentcost (v0.7.0) unstable; urgency=low</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../change.html#phase-currentcost-v0-6-0-unstable-urgency-low">phase-currentcost (v0.6.0) unstable; urgency=low</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../change.html#phase-currentcost-v0-5-0-unstable-urgency-low">phase-currentcost (v0.5.0) unstable; urgency=low</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../change.html#phase-currentcost-v0-4-1-unstable-urgency-low">phase-currentcost (v0.4.1) unstable; urgency=low</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../change.html#phase-currentcost-v0-4-0-unstable-urgency-low">phase-currentcost (v0.4.0) unstable; urgency=low</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../change.html#phase-currentcost-v0-3-9-unstable-urgency-low">phase-currentcost (v0.3.9) unstable; urgency=low</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../change.html#phase-currentcost-v0-3-8-unstable-urgency-low">phase-currentcost (v0.3.8) unstable; urgency=low</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../change.html#phase-currentcost-v0-3-7-unstable-urgency-low">phase-currentcost (v0.3.7) unstable; urgency=low</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../change.html#phase-currentcost-v0-3-6-unstable-urgency-low">phase-currentcost (v0.3.6) unstable; urgency=low</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../change.html#phase-currentcost-v0-3-5-unstable-urgency-low">phase-currentcost (v0.3.5) unstable; urgency=low</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../change.html#phase-currentcost-v0-3-4-unstable-urgency-low">phase-currentcost (v0.3.4) unstable; urgency=low</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../change.html#phase-currentcost-v0-3-3-unstable-urgency-low">phase-currentcost (v0.3.3) unstable; urgency=low</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../change.html#phase-currentcost-v0-3-2-unstable-urgency-low">phase-currentcost (v0.3.2) unstable; urgency=low</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../change.html#phase-currentcost-v0-3-1-unstable-urgency-low">phase-currentcost (v0.3.1) unstable; urgency=low</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../change.html#phase-currentcost-v0-3-0-unstable-urgency-low">phase-currentcost (v0.3.0) unstable; urgency=low</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../change.html#phase-currentcost-v0-2-3-unstable-urgency-low">phase-currentcost (v0.2.3) unstable; urgency=low</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../change.html#phase-currentcost-v0-2-2-unstable-urgency-low">phase-currentcost (v0.2.2) unstable; urgency=low</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../change.html#phase-currentcost-v0-2-1-unstable-urgency-low">phase-currentcost (v0.2.1) unstable; urgency=low</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../change.html#phase-currentcost-v0-2-0-unstable-urgency-low">phase-currentcost (v0.2.0) unstable; urgency=low</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../change.html#phase-currentcost-v0-1-10-unstable-urgency-low">phase-currentcost (v0.1.10) unstable; urgency=low</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../change.html#phase-currentcost-v0-1-9-unstable-urgency-low">phase-currentcost (v0.1.9) unstable; urgency=low</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../change.html#phase-currentcost-v0-1-8-unstable-urgency-low">phase-currentcost (v0.1.8) unstable; urgency=low</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../change.html#phase-currentcost-v0-1-7-unstable-urgency-low">phase-currentcost (v0.1.7) unstable; urgency=low</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../change.html#phase-currentcost-v0-1-6-unstable-urgency-low">phase-currentcost (v0.1.6) unstable; urgency=low</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../change.html#phase-currentcost-v0-1-5-unstable-urgency-low">phase-currentcost (v0.1.5) unstable; urgency=low</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../change.html#phase-currentcost-v0-1-4-unstable-urgency-low">phase-currentcost (v0.1.4) unstable; urgency=low</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../change.html#phase-currentcost-v0-1-3-unstable-urgency-low">phase-currentcost (v0.1.3) unstable; urgency=low</a></li>
</ul>
</li>
</ul>

        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">phase-currentcost</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../index.html">Module code</a> &raquo;</li>
      
    <li>currentcost.utils</li>
      <li class="wy-breadcrumbs-aside">
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            
  <h1>Source code for currentcost.utils</h1><div class="highlight"><pre>
<span class="c">#!/usr/bin/python</span>
<span class="c"># -*- coding: utf8 -*-</span>
<span class="c"># -*- Mode: Python; py-indent-offset: 4 -*-</span>

<span class="sd">&quot;&quot;&quot;Globals and function needs for this project.</span>

<span class="sd">.. module:: utils</span>
<span class="sd">    :platform: Unix</span>
<span class="sd">    :synopsis: This module contains all useful globals and function needed.</span>

<span class="sd">.. moduleauthor:: Pierre Leray &lt;pierreleray64@gmail.com&gt;</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">xml.etree</span> <span class="kn">import</span> <span class="n">ElementTree</span>

<span class="c"># Globals declaration for this project</span>
<span class="n">SUCCESS</span> <span class="o">=</span> <span class="s">&quot;currentcost&quot;</span>
<span class="n">ERROR</span> <span class="o">=</span> <span class="s">&quot;error&quot;</span>
<span class="n">TTY_CONNECTION_PROBLEM</span> <span class="o">=</span> <span class="s">&quot;CurrentCost </span><span class="si">%s</span><span class="s"> in </span><span class="si">%s</span><span class="s">: TTY connection problem: </span><span class="si">%s</span><span class="s"> </span><span class="se">\</span>
<span class="s">is unreachable. Retry connection in 5 seconds.&quot;</span>
<span class="n">TTY_TRYING_CONNECTION</span> <span class="o">=</span> <span class="s">&quot;CurrentCost </span><span class="si">%s</span><span class="s"> in </span><span class="si">%s</span><span class="s">: Trying to connect to </span><span class="si">%s</span><span class="s">.&quot;</span>
<span class="n">TTY_CONNECTION_SUCCESS</span> <span class="o">=</span> <span class="s">&quot;CurrentCost </span><span class="si">%s</span><span class="s"> in </span><span class="si">%s</span><span class="s">: Success connection to </span><span class="si">%s</span><span class="s">.&quot;</span>
<span class="n">TTY_DISCONNECTED</span> <span class="o">=</span> <span class="s">&quot;CurrentCost </span><span class="si">%s</span><span class="s"> in </span><span class="si">%s</span><span class="s">: TTY port </span><span class="si">%s</span><span class="s"> disconnected.&quot;</span>
<span class="n">CURRENTCOST_TIMEOUT</span> <span class="o">=</span> <span class="s">&quot;CurrentCost </span><span class="si">%s</span><span class="s"> in </span><span class="si">%s</span><span class="s">: Reach timeout. Verify </span><span class="se">\</span>
<span class="s">CurrentCost wire connection or wave range&quot;</span>
<span class="n">CC_INCORRECT_MESSAGE</span> <span class="o">=</span> <span class="s">&quot;CurrentCost </span><span class="si">%s</span><span class="s"> in </span><span class="si">%s</span><span class="s">: Send incorrect </span><span class="se">\</span>
<span class="s">message =&gt; </span><span class="si">%s</span><span class="s">.&quot;</span>
<span class="n">RABBIT_MQ_CONNECTION_PROBLEM</span> <span class="o">=</span> <span class="s">&quot;Problem trying to connect to RabbitMQ with </span><span class="se">\</span>
<span class="s">this configuration: username: </span><span class="si">%s</span><span class="s">, password: </span><span class="si">%s</span><span class="s">, host: </span><span class="si">%s</span><span class="s">&quot;</span>
<span class="n">RABBIT_MQ_CREDENTIAL_PROBLEM</span> <span class="o">=</span> <span class="s">&quot;Problem bad RabbitMQ credential with </span><span class="se">\</span>
<span class="s">this configuration: username: </span><span class="si">%s</span><span class="s">, password: </span><span class="si">%s</span><span class="s">, host: </span><span class="si">%s</span><span class="s">&quot;</span>
<span class="n">CURRENTCOST_UNICODE_ERROR</span> <span class="o">=</span> <span class="s">&quot;Bad message sent from currentcost, invalid ASCII&quot;</span>
<span class="c"># Logger initialization</span>
<span class="n">LOGGER</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s">&quot;currentcost&quot;</span><span class="p">)</span>


<div class="viewcode-block" id="argument_parser"><a class="viewcode-back" href="../../code.html#currentcost.utils.argument_parser">[docs]</a><span class="k">def</span> <span class="nf">argument_parser</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Method that parse arguments from command line, return an error in</span>
<span class="sd">    case of missing parameter or return arguments with their value.</span>

<span class="sd">    :returns:  dict -- Dict containing arguments.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c"># Get command line arguments</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
    <span class="c"># Define expected arguments</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&quot;variable_name&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&quot;name of the variable&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&quot;site_name&quot;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s">&quot;name of the location of the variable&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&quot;-t&quot;</span><span class="p">,</span> <span class="s">&quot;--tty-port&quot;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s">&quot;tty port to connect to current cost&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&quot;-r&quot;</span><span class="p">,</span> <span class="s">&quot;--rabbitmq-credential&quot;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s">&quot;credential for rabbitMQ. By default, RabbitMQ is</span><span class="se">\</span>
<span class="s">                        deactivated. To activate it you have to give your </span><span class="se">\</span>
<span class="s">                        credential. Format: username:password.&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&quot;-l&quot;</span><span class="p">,</span> <span class="s">&quot;--log-conf&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&quot;path to log configuration&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&quot;-v&quot;</span><span class="p">,</span> <span class="s">&quot;--verbose&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&quot;activate verbose mode&quot;</span><span class="p">,</span>
                        <span class="n">action</span><span class="o">=</span><span class="s">&quot;store_true&quot;</span><span class="p">)</span>
    <span class="c"># Return list of argument passed in command line</span>
    <span class="k">return</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="init_message"><a class="viewcode-back" href="../../code.html#currentcost.utils.init_message">[docs]</a><span class="k">def</span> <span class="nf">init_message</span><span class="p">(</span><span class="n">variable_name</span><span class="p">,</span> <span class="n">site_name</span><span class="p">,</span> <span class="n">tty_port</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Create log message starting current cost.</span>

<span class="sd">    :param variable_name: Name of the Variable.</span>
<span class="sd">    :type variable_name: str.</span>

<span class="sd">    :param site_name: Name of the Site.</span>
<span class="sd">    :type site_name: str.</span>

<span class="sd">    :param tty_port: TTY port path.</span>
<span class="sd">    :type tty_port: str.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c"># Create init message</span>
    <span class="n">message</span> <span class="o">=</span> <span class="s">&quot;Starting current cost application</span><span class="se">\n</span><span class="s">&quot;</span>
    <span class="n">message</span> <span class="o">+=</span> <span class="s">&quot;Current time: </span><span class="si">%s</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
    <span class="n">message</span> <span class="o">+=</span> <span class="s">&quot;Variable name: </span><span class="si">%s</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">variable_name</span>
    <span class="n">message</span> <span class="o">+=</span> <span class="s">&quot;Site name: </span><span class="si">%s</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">site_name</span>
    <span class="n">message</span> <span class="o">+=</span> <span class="s">&quot;TTY port: </span><span class="si">%s</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">tty_port</span>
    <span class="c"># We log this message</span>
    <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="verbose_mode"><a class="viewcode-back" href="../../code.html#currentcost.utils.verbose_mode">[docs]</a><span class="k">def</span> <span class="nf">verbose_mode</span><span class="p">(</span><span class="n">verbose</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Active verbose mode.</span>

<span class="sd">    :param verbose: Boolean if true active verbose mode.</span>
<span class="sd">    :type variable_name: bool.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c"># If verbose mode is activated</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="c"># Create an handler to console and display log message</span>
        <span class="n">sth</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">StreamHandler</span><span class="p">()</span>
        <span class="n">sth</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>
        <span class="c"># Add this handler to current logger</span>
        <span class="n">LOGGER</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">sth</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="data_validator"><a class="viewcode-back" href="../../code.html#currentcost.utils.data_validator">[docs]</a><span class="k">def</span> <span class="nf">data_validator</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">variable_name</span><span class="p">,</span> <span class="n">site_name</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Analyse data from currentcost and return according TOPIC and MESSAGE.</span>

<span class="sd">    :param data: XML string that contain data.</span>
<span class="sd">    :type variable_name: str.</span>

<span class="sd">    :param variable_name: Name of the Variable.</span>
<span class="sd">    :type variable_name: str.</span>

<span class="sd">    :param site_name: Name of the Site.</span>
<span class="sd">    :type site_name: str.</span>

<span class="sd">    :returns:  str -- Topic of the message (error or success) and</span>
<span class="sd">        Message containing error description or data sent by CC.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c"># Initialization of variable</span>
    <span class="n">topic</span> <span class="o">=</span> <span class="n">ERROR</span>
    <span class="n">message</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="c"># If data is empty, that means we reach a Timeout</span>
    <span class="k">if</span> <span class="n">data</span> <span class="o">==</span> <span class="s">&quot;&quot;</span><span class="p">:</span>
        <span class="n">message</span> <span class="o">=</span> <span class="n">CURRENTCOST_TIMEOUT</span> <span class="o">%</span> <span class="p">(</span><span class="n">variable_name</span><span class="p">,</span> <span class="n">site_name</span><span class="p">)</span>
    <span class="c"># Else we retrieve a string</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c"># We remove useless end-line and new-line caracteres</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\r</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c"># We expect a valid XML</span>
            <span class="n">ElementTree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">ParseError</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c"># If it&#39;s not a valid XML, we expected it&#39;s a good string</span>
                <span class="c"># and return an error</span>
                <span class="n">message</span> <span class="o">=</span> <span class="n">CC_INCORRECT_MESSAGE</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">variable_name</span><span class="p">,</span>
                    <span class="n">site_name</span><span class="p">,</span>
                    <span class="n">data</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">UnicodeDecodeError</span><span class="p">:</span>
                <span class="c"># If it&#39;s not a good string, we send according message</span>
                <span class="n">message</span> <span class="o">=</span> <span class="n">CC_INCORRECT_MESSAGE</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">variable_name</span><span class="p">,</span>
                    <span class="n">site_name</span><span class="p">,</span>
                    <span class="n">CURRENTCOST_UNICODE_ERROR</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># Else, we return our message with according topic</span>
            <span class="n">topic</span> <span class="o">=</span> <span class="n">SUCCESS</span>
            <span class="n">message</span> <span class="o">=</span> <span class="n">data</span>

    <span class="k">return</span> <span class="n">topic</span><span class="p">,</span> <span class="n">message</span></div>
</pre></div>

          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2014, Pierre Leray.
    </p>
  </div>

  <a href="https://github.com/snide/sphinx_rtd_theme">Sphinx theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'1.0.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>